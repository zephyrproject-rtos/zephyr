# Networking - using IPv6 because it supports routing
CONFIG_NETWORKING=y
CONFIG_NET_DRIVERS=y
CONFIG_NET_IPV6=y
CONFIG_NET_UDP=y
CONFIG_NET_SOCKETS=y
CONFIG_NET_NATIVE=y

# Needed for SO_BINDTODEVICE name resolution via net_if_get_by_name()
CONFIG_NET_INTERFACE_NAME=y
CONFIG_NET_INTERFACE_NAME_LEN=8

# Point-to-point link configuration with routing
# Physical UART cross-wiring provides L1/L2, but we need L3 routing
# to accept packets arriving on one interface destined for another
CONFIG_NET_ROUTING=y
# Disable auto-configuration to avoid multicast on point-to-point SLIP links
CONFIG_NET_IPV6_ND=n
CONFIG_NET_IPV6_DAD=n
CONFIG_NET_IPV6_MLD=n

# Disable IP check to force packets through physical UART layer
# Use different subnets (fd00:1::/64 and fd00:2::/64) so routing handles delivery
# CONFIG_NET_ROUTING creates automatic interface routes for each subnet
CONFIG_NET_IP_ADDR_CHECK=n
CONFIG_NET_MAX_ROUTES=8
CONFIG_NET_ROUTE_MCAST=n

# SLIP UART Async driver
CONFIG_COBS_UART_ASYNC=y
CONFIG_NET_L2_COBS_SERIAL=y
CONFIG_COBS=y
CONFIG_NET_L2_COBS_SERIAL_RX_MARK_LOOPBACK=y

# High-throughput tuning (1Mbaud, no HW flow control):
# Ring buffer must be larger than a full encoded frame (~563 bytes) to avoid
# overrun when bytes arrive faster than the RX worker can drain.
CONFIG_COBS_UART_ASYNC_RINGBUF_SIZE=8192
CONFIG_COBS_UART_ASYNC_RX_BUF_LEN=1024
CONFIG_COBS_UART_ASYNC_RX_PRIORITY=2

# RX timeout: trigger RX processing after end of frame detected
# At 1Mbaud: 10us/byte, so 100us = ~10 bytes of idle time detection
# With tickless kernel, we can use very low timeouts for minimal latency
CONFIG_COBS_UART_ASYNC_RX_TIMEOUT_US=100

# UART
CONFIG_UART_ASYNC_API=y
CONFIG_SERIAL=y

# Buffer configuration for two interfaces
# Need larger buffers for: 512B payload + IPv6 header (40B) + UDP header (8B)
# + COBS overhead (~0.4%) + fragment metadata
CONFIG_NET_BUF_DATA_SIZE=2048
CONFIG_NET_PKT_RX_COUNT=32
CONFIG_NET_PKT_TX_COUNT=32
CONFIG_NET_BUF_RX_COUNT=64
CONFIG_NET_BUF_TX_COUNT=64

# Increase interface count for multiple SLIP interfaces
CONFIG_NET_MAX_CONTEXTS=10
CONFIG_NET_IF_MAX_IPV6_COUNT=8
CONFIG_NET_MAX_CONN=10
CONFIG_NET_MAX_ROUTES=8
CONFIG_NET_IPV6_MAX_NEIGHBORS=8

# Logging - PERF default (turn on DBG only when debugging)
# Disable INFO logging in hot paths for maximum throughput
CONFIG_LOG=y
CONFIG_NET_LOG=n
CONFIG_LOG_DEFAULT_LEVEL=2
CONFIG_COBS_UART_ASYNC_LOG_LEVEL_WRN=y
CONFIG_NET_L2_COBS_SERIAL_LOG_LEVEL_WRN=y

# Testing
CONFIG_ZTEST=y

# Dramatically increase stacks to rule out any stack size issues
# Testing shows stack overflow even with 16KB - trying 32KB
CONFIG_MAIN_STACK_SIZE=16384
CONFIG_ZTEST_STACK_SIZE=32768

# Stack debugging
CONFIG_THREAD_STACK_INFO=y
CONFIG_THREAD_NAME=y
CONFIG_THREAD_RUNTIME_STATS=y

# Kernel - high resolution timing for low latency
CONFIG_TICKLESS_KERNEL=y
CONFIG_SYS_CLOCK_TICKS_PER_SEC=10000
CONFIG_HEAP_MEM_POOL_SIZE=32768

# Random number generator (required by networking stack)
CONFIG_ENTROPY_GENERATOR=y
CONFIG_TEST_RANDOM_GENERATOR=y
