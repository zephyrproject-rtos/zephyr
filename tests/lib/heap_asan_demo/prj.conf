#
# ASAN Heap Poisoning Demo - Project Configuration
#
# This configuration enables ASAN integration with sys_heap allocator.
# Uncomment specific crash test options below to demonstrate ASAN detection.
#

# Test framework
CONFIG_ZTEST=y
CONFIG_ZTEST_STACK_SIZE=2048

# Heap validation and debugging
CONFIG_SYS_HEAP_VALIDATE=y
CONFIG_ASSERT=y
CONFIG_SYS_HEAP_RUNTIME_STATS=y

# Logging
CONFIG_DEBUG=y
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=3

# Address Sanitizer
CONFIG_ASAN=y
CONFIG_SYS_HEAP_ASAN_POISONING=y

# =============================================================================
# ASAN Memory Poisoning Demonstration Tests
# =============================================================================
# These tests are part of the heap_asan_demo comprehensive validation suite.
# Each test deliberately triggers a specific type of memory error to demonstrate
# ASAN's detection capabilities.
#
# USAGE:
#   1. Uncomment ONE crash test configuration below
#   2. Build: west build -p -b native_sim tests/lib/heap_asan_demo
#   3. Run: ./build/zephyr/zephyr.exe
#   4. Observe ASAN error message demonstrating detection
#
# WARNING: These tests will intentionally crash! Only enable ONE at a time.
#

# Crash Test 1: Use-After-Free Detection
# Demonstrates ASAN detection when accessing freed memory.
# Test allocates memory, frees it, then attempts to read the freed block.
# Expected result: AddressSanitizer: use-after-poison on address 0x...
#CONFIG_HEAP_ASAN_DEMO_CRASH_USE_AFTER_FREE=y

# Crash Test 2: Unallocated Memory Access Detection
# Demonstrates ASAN detection when accessing never-allocated heap memory.
# Test identifies a poisoned heap region and attempts to read from it.
# Expected result: AddressSanitizer: use-after-poison on address 0x...
#CONFIG_HEAP_ASAN_DEMO_CRASH_UNALLOCATED=y

# Crash Test 3: Buffer Overflow Detection
# Demonstrates ASAN detection when writing beyond allocation boundaries.
# Test allocates adjacent blocks, frees one, then overflows into freed region.
# Expected result: AddressSanitizer: use-after-poison on address 0x...
# (if the overflow reaches the poisoned adjacent memory)
#CONFIG_HEAP_ASAN_DEMO_CRASH_BUFFER_OVERFLOW=y

# Crash Test 4: Use-After-Realloc Detection
# Demonstrates ASAN detection when accessing old pointer after realloc relocation.
# Test allocates memory, forces realloc to relocate it, then accesses old address.
# This is a variant of use-after-free specific to realloc() operations.
# Expected result: AddressSanitizer: use-after-poison on address 0x...
#CONFIG_HEAP_ASAN_DEMO_CRASH_USE_AFTER_REALLOC=y
