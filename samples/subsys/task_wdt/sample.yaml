sample:
  name: Task Watchdog Subsytem Sample
common:
  tags:
    - task_wdt
  depends_on: watchdog
  platform_exclude:
    - s32z2xxdc2/s32z270/rtu0
    - s32z2xxdc2/s32z270/rtu1
    - s32z2xxdc2@D/s32z270/rtu0
    - s32z2xxdc2@D/s32z270/rtu1

tests:
  sample.task_wdt:
    harness: console
    harness_config:
      type: multi_line
      ordered: true
      regex:
        - "Task watchdog sample application."
        - "Control thread started."
        - "Main thread still alive..."
        - "Control thread getting stuck..."
        - "Task watchdog channel 1 callback, thread: control"
        - "Resetting device...(.*)"
        - "Task watchdog sample application."
    integration_platforms:
      - nucleo_g474re

  sample.task_wdt.multistage:
    platform_allow:
      - apollo3_evb
      - apollo3p_evb
      - apollo4p_evb
      - apollo4p_blue_kxr_evb
      - apollo510_evb
      - apollo510_eb
    timeout: 240
    extra_configs:
      - CONFIG_TASK_WDT_HW_FALLBACK=y
      - CONFIG_TASK_WDT_HW_FALLBACK_DELAY=5000
      - CONFIG_WDT_MULTISTAGE=y
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "\\[HW WDT\\] bark stage reached \\(interrupt\\)"
