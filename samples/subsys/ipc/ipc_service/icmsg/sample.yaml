sample:
  name: IPC Service example integration (icmsg backend)
common:
  timeout: 30
  tags: ipc
  sysbuild: true
tests:
  sample.ipc.icmsg:
    platform_allow:
      - nrf5340dk/nrf5340/cpuapp
      - nrf5340bsim/nrf5340/cpuapp
    integration_platforms:
      - nrf5340dk/nrf5340/cpuapp
      - nrf5340bsim/nrf5340/cpuapp
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "host: IPC-service HOST demo started"
        - "host: Ep bounded"
        - "host: Perform sends for"
        - "host: Sent"
        - "host: Received"
        - "host: IPC-service HOST demo ended"

  sample.ipc.icmsg.nrf54l:
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    extra_args:
      - icmsg_SNIPPET=nordic-flpr
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "host: IPC-service HOST demo started"
        - "host: Ep bounded"
        - "host: Perform sends for"
        - "host: Sent"
        - "host: Received"
        - "host: IPC-service HOST demo ended"

  sample.ipc.icmsg.nrf54l_no_multithreading:
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    extra_args:
      - icmsg_SNIPPET=nordic-flpr
      - icmsg_CONFIG_MULTITHREADING=n
      - icmsg_CONFIG_LOG_MODE_MINIMAL=y
      - remote_CONFIG_MULTITHREADING=n
      - remote_CONFIG_LOG_MODE_MINIMAL=y
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "I: IPC-service HOST demo started"
        - "I: Ep bounded"
        - "I: Perform sends for"
        - "I: Sent"
        - "I: Received"
        - "I: IPC-service HOST demo ended"

  sample.ipc.icmsg.nrf54l_remote_no_multithreading:
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    extra_args:
      - icmsg_SNIPPET=nordic-flpr
      - remote_CONFIG_MULTITHREADING=n
      - remote_CONFIG_LOG_MODE_MINIMAL=y
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "host: IPC-service HOST demo started"
        - "host: Ep bounded"
        - "host: Perform sends for"
        - "host: Sent"
        - "host: Received"
        - "host: IPC-service HOST demo ended"

  sample.ipc.icmsg.nrf54h20:
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp
    extra_args:
      - icmsg_SNIPPET=nordic-ppr
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "host: IPC-service HOST demo started"
        - "host: Ep bounded"
        - "host: Perform sends for"
        - "host: Sent"
        - "host: Received"
        - "host: IPC-service HOST demo ended"

  sample.ipc.icmsg.nrf54h20_remote_no_multithreading:
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp
    extra_args:
      - icmsg_SNIPPET=nordic-ppr
      - remote_CONFIG_MULTITHREADING=n
      - remote_CONFIG_LOG_MODE_MINIMAL=y
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "host: IPC-service HOST demo started"
        - "host: Ep bounded"
        - "host: Perform sends for"
        - "host: Sent"
        - "host: Received"
        - "host: IPC-service HOST demo ended"

  sample.ipc.icbmsg.nrf54l:
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    extra_args:
      - icmsg_SNIPPET=nordic-flpr
      - icmsg_CONFIG_IPC_SERVICE_BACKEND_ICBMSG_NUM_EP=1
      - icmsg_FILE_SUFFIX=icbmsg
      - remote_CONFIG_IPC_SERVICE_BACKEND_ICBMSG_NUM_EP=1
      - remote_FILE_SUFFIX=icbmsg
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "host: IPC-service HOST demo started"
        - "host: Ep bounded"
        - "host: Perform sends for"
        - "host: Sent"
        - "host: Received"
        - "host: IPC-service HOST demo ended"

  sample.ipc.icbmsg.nrf54l_no_multithreading:
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    extra_args:
      - icmsg_SNIPPET=nordic-flpr
      - icmsg_CONFIG_IPC_SERVICE_BACKEND_ICBMSG_NUM_EP=1
      - icmsg_FILE_SUFFIX=icbmsg
      - icmsg_CONFIG_MULTITHREADING=n
      - icmsg_CONFIG_LOG_MODE_MINIMAL=y
      - remote_CONFIG_IPC_SERVICE_BACKEND_ICBMSG_NUM_EP=1
      - remote_FILE_SUFFIX=icbmsg
      - remote_CONFIG_MULTITHREADING=n
      - remote_CONFIG_LOG_MODE_MINIMAL=y
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "I: IPC-service HOST demo started"
        - "I: Ep bounded"
        - "I: Perform sends for"
        - "I: Sent"
        - "I: Received"
        - "I: IPC-service HOST demo ended"

  sample.ipc.icbmsg.nrf54l_remote_no_multithreading:
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54lm20dk/nrf54lm20a/cpuapp
    extra_args:
      - icmsg_SNIPPET=nordic-flpr
      - icmsg_CONFIG_IPC_SERVICE_BACKEND_ICBMSG_NUM_EP=1
      - icmsg_FILE_SUFFIX=icbmsg
      - remote_CONFIG_IPC_SERVICE_BACKEND_ICBMSG_NUM_EP=1
      - remote_FILE_SUFFIX=icbmsg
      - remote_CONFIG_MULTITHREADING=n
      - remote_CONFIG_LOG_MODE_MINIMAL=y
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "host: IPC-service HOST demo started"
        - "host: Ep bounded"
        - "host: Perform sends for"
        - "host: Sent"
        - "host: Received"
        - "host: IPC-service HOST demo ended"
