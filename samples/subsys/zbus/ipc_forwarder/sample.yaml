sample:
  name: IPC Forwarder
  description: Sample application demonstrating Zbus IPC forwarder functionality.
tests:
  sample.zbus.ipc_forwarder.nrf54h20_cpuapp_cpurad:
    sysbuild: true
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    extra_args:
      - SNIPPET=nordic-log-stm
      - SB_CONFIG_REMOTE_BOARD_NRF54H20_CPURAD=y
    timeout: 30
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - ".* app/main: Channel request_channel is a master channel"
        - ".* app/main: Channel response_channel is a shadow channel"
        - ".* rad/main: Channel request_channel is a shadow channel"
        - ".* rad/main: Channel response_channel is a master channel"
        - ".* app/main: Published on channel request_channel. Request ID=1, Min=-1, Max=1"
        - ".* rad/main: Received message on channel request_channel"
        - ".* rad/main: Request ID: 1, Min: -1, Max: 1"
        - ".* rad/main: Sending response: ID=1, Value=.*"
        - ".* rad/main: Response published on channel response_channel"
        - ".* app/main: Received message on channel response_channel"
        - ".* app/main: Response ID: 1, Value: .*"

  sample.zbus.ipc_forwarder.nrf54h20_cpuapp_cpuppr:
    sysbuild: true
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    extra_args:
      - SNIPPET=nordic-log-stm
      - SB_CONFIG_REMOTE_BOARD_NRF54H20_CPUPPR=y
    timeout: 30
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - ".* app/main: Channel request_channel is a master channel"
        - ".* app/main: Channel response_channel is a shadow channel"
        - ".* ppr/main: Channel request_channel is a shadow channel"
        - ".* ppr/main: Channel response_channel is a master channel"
        - ".* app/main: Published on channel request_channel. Request ID=1, Min=-1, Max=1"
        - ".* ppr/main: Received message on channel request_channel"
        - ".* ppr/main: Request ID: 1, Min: -1, Max: 1"
        - ".* ppr/main: Sending response: ID=1, Value=.*"
        - ".* ppr/main: Response published on channel response_channel"
        - ".* app/main: Received message on channel response_channel"
        - ".* app/main: Response ID: 1, Value: .*"

  sample.zbus.ipc_forwarder.nrf54h20_cpuapp_cpuppr_xip:
    sysbuild: true
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    extra_args:
      - SNIPPET=nordic-log-stm
      - SB_CONFIG_REMOTE_BOARD_NRF54H20_CPUPPR_XIP=y
    timeout: 30
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - ".* app/main: Channel request_channel is a master channel"
        - ".* app/main: Channel response_channel is a shadow channel"
        - ".* ppr/main: Channel request_channel is a shadow channel"
        - ".* ppr/main: Channel response_channel is a master channel"
        - ".* app/main: Published on channel request_channel. Request ID=1, Min=-1, Max=1"
        - ".* ppr/main: Received message on channel request_channel"
        - ".* ppr/main: Request ID: 1, Min: -1, Max: 1"
        - ".* ppr/main: Sending response: ID=1, Value=.*"
        - ".* ppr/main: Response published on channel response_channel"
        - ".* app/main: Received message on channel response_channel"
        - ".* app/main: Response ID: 1, Value: .*"

  sample.zbus.ipc_forwarder.nrf54h20_cpuapp_cpuflpr_xip:
    sysbuild: true
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    extra_args:
      - SNIPPET=nordic-log-stm
      - SB_CONFIG_REMOTE_BOARD_NRF54H20_CPUFLPR_XIP=y
    timeout: 30
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - ".* app/main: Channel request_channel is a master channel"
        - ".* app/main: Channel response_channel is a shadow channel"
        - ".* flpr/main: Channel request_channel is a shadow channel"
        - ".* flpr/main: Channel response_channel is a master channel"
        - ".* app/main: Published on channel request_channel. Request ID=1, Min=-1, Max=1"
        - ".* flpr/main: Received message on channel request_channel"
        - ".* flpr/main: Request ID: 1, Min: -1, Max: 1"
        - ".* flpr/main: Sending response: ID=1, Value=.*"
        - ".* flpr/main: Response published on channel response_channel"
        - ".* app/main: Received message on channel response_channel"
        - ".* app/main: Response ID: 1, Value: .*"

  sample.zbus.ipc_forwarder.nrf5340_cpuapp_cpunet:
    sysbuild: true
    platform_allow:
      - nrf5340dk/nrf5340/cpuapp
      - nrf5340bsim/nrf5340/cpuapp
    integration_platforms:
      - nrf5340bsim/nrf5340/cpuapp
    tags: ipc
    timeout: 30
    harness: console
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - ".* main: Channel request_channel is a master channel"
        - ".* main: Channel response_channel is a shadow channel"
        - ".* main: Published on channel request_channel. Request ID=1, Min=-1, Max=1"
        - ".* main: Received message on channel response_channel"
        - ".* main: Response ID: 1, Value: .*"
