/*
 * Copyright (c) 2025 Cypress Semiconductor Corporation.
 * SPDX-License-Identifier: Apache-2.0
 */

/dts-v1/;
#include <arm/infineon/cat1b/mpns/psc3m5fds2afq1_s.dtsi>
#include <arm/infineon/cat1b/psc3/system_clocks.dtsi>
#include <arm/infineon/cat1b/psc3/psc3_partition.dtsi>
#include "kit_psc3m5_evk-common.dtsi"
#include "kit_psc3m5_evk-pinctrl.dtsi"

/ {
	model = "The Infineon PSOCâ„¢ Control C3M5 Evaluation Kit";
	compatible = "infineon,kit_psc3m5_evk", "infineon,PSC3M5";

	aliases {
		watchdog0 = &watchdog0;
	};

	chosen {
		zephyr,sram = &sram0;
		zephyr,flash = &slot0_partition;
		zephyr,console = &uart3;
		zephyr,shell-uart = &uart3;
		zephyr,canbus = &can1;
	};

	can_phy0: can-phy0 {
		compatible = "can-transceiver-gpio";
		status = "okay";
		standby-gpios = <&gpio_prt7 6 GPIO_ACTIVE_LOW>;
		max-bitrate = <5000000>;
		min-bitrate = <15000>;
		#phy-cells = <0>;
	};
};

uart3: &scb3 {
	compatible = "infineon,uart";
	status = "okay";
	current-speed = <115200>;

	clocks = <&peri0_group4_8bit_0>;

	pinctrl-0 = <&p6_3_scb3_uart_tx &p6_2_scb3_uart_rx &p6_1_scb3_uart_rts &p6_0_scb3_uart_cts>;
	pinctrl-names = "default";
};

&can1 {
	compatible = "infineon,can";
	status = "okay";
	clocks = <&peri0_group4_8bit_1>;
	pinctrl-0 = <&p5_3_can1_ttcan_tx &p5_2_can1_ttcan_rx>;
	pinctrl-names = "default";
	phys = <&can_phy0>;
};

&peri0_group4_8bit_1 {
	status = "okay";
	resource-type = <IFX_RSC_CAN>;
	resource-instance = <0>;
	resource-channel = <1>;
	clock-div = <3>;
};

&peri0_group4_8bit_0 {
	status = "okay";
	resource-type = <IFX_RSC_SCB>;
	resource-instance = <3>;
	clock-div = <109>;
};

&watchdog0 {
	status = "okay";
};

&mcwdt0 {
	status = "okay";
};

&fll0 {
	clock-frequency = <96000000>;
	status = "okay";
};

/* For the dpll clocks declared below
 * The clock-frequency value is here for dts reference, but
 * it does not affect the frequency set by the clock_control
 * driver. That is decided by the rest of the variables in
 * this block. They result in the set clock-frequency. For other
 * frequencies, they need to be calculated separately and
 * entered into the devicetree dpll_* block.
 */

/* This dpll_lp0 is on "clock path" 1. So HF clocks sourced
 * from *_CLKPATH1 will receive this frequency, when the
 * dpll_lp0 is set to "okay".
 */
&dpll_lp0 {
	status = "okay";
	clock-frequency = <180000000>;

	feedback-div = <45>;
	reference-div = <6>;
	output-div = <2>;
	fraction-div = <0>;
	dco-mode-enable;
};

/* This dpll_lp1 is on "clock path" 2. So HF clocks sourced
 * from *_CLKPATH2 will receive this frequency instead, when the
 * dpll_lp1 is set to "okay".
 */
&dpll_lp1 {
	status = "okay";
	clock-frequency = <240000000>;

	feedback-div = <60>;
	reference-div = <6>;
	output-div = <2>;
	fraction-div = <0>;
	dco-mode-enable;
};

&path_mux0 {
	status = "okay";
};

&path_mux1 {
	status = "okay";
};

&path_mux2 {
	status = "okay";
};

&path_mux3 {
	status = "okay";
};

&clk_hf0 {
	source-path = <IFX_CLK_HF_IN_CLKPATH1>;
	status = "okay";
};

&clk_hf1 {
	source-path = <IFX_CLK_HF_IN_CLKPATH1>;
	status = "okay";
};

&clk_hf2 {
	source-path = <IFX_CLK_HF_IN_CLKPATH0>;
	status = "okay";
};

&clk_hf3 {
	source-path = <IFX_CLK_HF_IN_CLKPATH2>;
	status = "okay";
};
