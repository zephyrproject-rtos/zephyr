# Copyright (c) 2025 Advanced Micro Devices, Inc.
#
# SPDX-License-Identifier: Apache-2.0

proc load_image args  {
	set elf_file [lindex $args 0]
	set pdi_file [lindex $args 1]
	set bl31_file [lindex $args 2]

	if { [info exists ::env(HW_SERVER_URL)] } {
		connect -url $::env(HW_SERVER_URL)
	} else {
		connect
	}

	device program $pdi_file
	targets -set -nocase -filter {name =~ "Versal*"}
	after 100
	targets -set -filter {name =~ "Cortex-A78AE*0.0"}
	rst -proc
	after 100
	dow -force $elf_file
	dow -force $bl31_file
	con
	exit
}

load_image {*}$argv
