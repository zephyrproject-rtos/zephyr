if {[info exists env(OPENOCD_INTERFACE)]} {
	set INTERFACE $env(OPENOCD_INTERFACE)
} else {
	set INTERFACE "cmsis-dap"
}

source [find interface/$INTERFACE.cfg]

transport select jtag

adapter speed 2000

set _TARGET rcpu
set _CHIPNAME k1

jtag newtap pre unknown -irlen 1 -expected-id 0x00000000 -disable
jtag configure pre.unknown -event tap-enable ""

jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x10308A6D -disable
jtag configure $_CHIPNAME.cpu -event tap-enable ""

jtag newtap post unknown -irlen 9 -expected-id 0x08501C0D -ignore-version

jtag configure post.unknown -event setup {
    global _CHIPNAME 0xe

    irscan post.unknown 0x98
    drscan post.unknown 16 0xe

    jtag tapenable pre.unknown
    jtag tapenable $_CHIPNAME.cpu
}

set _TARGETNAME $_CHIPNAME.cpu_$_TARGET

target create $_TARGETNAME.0 riscv -chain-position $_CHIPNAME.cpu

$_TARGETNAME.0 configure -event examine-start {
    adapter speed 8000
    puts [ adapter speed ]
}
