# Copyright (c) 2024 Alexander Kozhinov <ak.alexander.kozhinov@gmail.com>
# SPDX-License-Identifier: Apache-2.0

proc version_compare {v1 v2} {
	foreach n1 [split $v1 .] n2 [split $v2 .] {
		if {$n1 < $n2} {return -1}
		if {$n1 > $n2} {return 1}
	}
	return 0
}

set current_version [version]
regexp {([0-9]+\.[0-9]+\.[0-9]+)} $current_version -> current_version

if {[version_compare $current_version "0.12.0"] >= 0} {
	# OpenOCD version is 0.12.0 or newer - initialize Segger RTT server
	init
	rtt setup 0x20000000 10000 "SEGGER RTT"
	rtt start
	rtt server start 9090 0
} else {
	# OpenOCD version is older than 0.12.0
	echo "Warn: OpenOCD $current_version does not support Segger RTT"
}
