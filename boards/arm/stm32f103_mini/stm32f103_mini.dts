/*
 * Copyright (c) 2020 WuhanStudio
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/dts-v1/;
#include <st/f1/stm32f103Xc.dtsi>
#include <st/f1/stm32f103r(c-d-e)tx-pinctrl.dtsi>

/ {
	model = "stm32f103_mini board";
	compatible = "st,stm32f103";

	chosen {
		zephyr,console = &usart1;
		zephyr,shell-uart = &usart1;
		zephyr,sram = &sram0;
		zephyr,flash = &flash0;
	};

	leds {
		compatible = "gpio-leds";
		green_led_1: led_1 {
			gpios = <&gpiod 2 GPIO_ACTIVE_HIGH>;
			label = "User LD1";
		};
	};

	buttons {
		compatible="gpio-keys";

		button0: button0 {
			gpios= <&gpioa 0 (GPIO_ACTIVE_HIGH|GPIO_PULL_DOWN)>;
			label ="User Push Button 0";
		};
		
		button1:button1{
			gpios= <&gpioc 5 (GPIO_ACTIVE_HIGH|GPIO_PULL_UP)>;
			label="User Push Button 1";
		};
		button2:button2{
			gpios= <&gpioa 15 (GPIO_ACTIVE_HIGH|GPIO_PULL_UP)>;
			label ="User Push Button 2";
		};

	};

	aliases {
		led0 = &green_led_1;
		lcd0 = &lcd_st7735;
		sw0 = &button0;
		sw1 = &button1;
		sw2 = &button2;
	};
};

&usart1 {
	pinctrl-0 = <&usart1_tx_pa9 &usart1_rx_pa10>;
	current-speed = <115200>;
	status = "okay";
};

&usart2 {
	pinctrl-0 = <&usart2_tx_pa2 &usart2_rx_pa3>;
	current-speed = <115200>;
};

&usart3 {
	pinctrl-0 = <&usart3_tx_pb10 &usart3_rx_pb11>;
	current-speed = <115200>;
};

&i2c1 {
	pinctrl-0 = <&i2c1_scl_pb8 &i2c1_sda_pb9>;
	status = "okay";
	clock-frequency = <I2C_BITRATE_FAST>;
};
/*dma1 通道3 请求1 内存到外设 外设地址不自增 内存地址自增 高优先级*/
&spi1 {
	pinctrl-0 = <&spi1_nss_master_pa4 &spi1_sck_master_pa5
		     &spi1_miso_master_pa6 &spi1_mosi_master_pa7>;
	status = "okay";
	dmas = <&dma1 3 0x20440>,
            <&dma1 2 0x20480>;
    dma-names = "tx", "rx";

	cs-gpios = <&gpioa 4 GPIO_ACTIVE_LOW>;
	lcd_st7735:st7735@0{
			compatible = "sitronix,st7735";
			reg=<0>;
			spi-max-frequency = <18000000>; /* 8MHz 36000000*/
			label = "ST7735";
			reset-gpios = <&gpiob 12 GPIO_ACTIVE_HIGH>;
			blk_gpios = <&gpioa 1 GPIO_ACTIVE_HIGH>;
			cmd-data-gpios = <&gpioc 4 GPIO_ACTIVE_HIGH>;
			width = <129>;
			height = <160>;
	};
};
&dma1 {
	status = "okay";
};

&spi2 {
	pinctrl-0 = <&spi2_nss_master_pb12 &spi2_sck_master_pb13
		     &spi2_miso_master_pb14 &spi2_mosi_master_pb15>;
	status = "okay";
};

&iwdg {
	status = "okay";
};

&timers1 {
	status = "okay";

	pwm1: pwm {
		status = "okay";
		pinctrl-0 = <&tim1_ch1_pwm_pa8>;
	};
};

&adc1 {
	pinctrl-0 = <&adc1_in0_pa0>;
	status = "okay";
};
