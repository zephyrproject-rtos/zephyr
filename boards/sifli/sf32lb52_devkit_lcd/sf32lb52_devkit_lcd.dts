/*
 * Copyright (c) 2025 Core Devices LLC
 * SPDX-License-Identifier: Apache-2.0
 */

/dts-v1/;

#include <sifli/sf32lb52x.dtsi>
#include <sifli/sf32lb52x-ram012.dtsi>
#include <zephyr/dt-bindings/dma/sf32lb52x-dma.h>
#include <zephyr/dt-bindings/gpio/gpio.h>
#include <zephyr/dt-bindings/i2c/i2c.h>
#include <zephyr/dt-bindings/input/input-event-codes.h>

#include "sf32lb52_devkit_lcd-pinctrl.dtsi"

/ {
	model = "SiFli SF32LB52-DevKit-LCD";
	compatible = "sifli,sf32lb52-devkit-lcd";

	chosen {
		zephyr,flash = &py25q128ha;
		zephyr,flash-controller = &mpi2;
		zephyr,code-partition = &code;
		zephyr,console = &usart1;
		zephyr,shell-uart = &usart1;
		zephyr,crc = &crc;
		zephyr,entropy = &trng;
		zephyr,bt-hci = &mailbox;
	};

	buttons {
		compatible = "gpio-keys";

		key1: key1 {
			label = "KEY1";
			gpios = <&gpioa_32_44 2 GPIO_ACTIVE_HIGH>;
			zephyr,code = <INPUT_KEY_1>;
		};

		key2: key2 {
			label = "KEY2";
			gpios = <&gpioa_00_31 11 GPIO_ACTIVE_HIGH>;
			zephyr,code = <INPUT_KEY_2>;
		};
	};

	leds {
		compatible = "gpio-leds";

		led0: led0 {
			label = "LED0";
			gpios = <&gpioa_00_31 26 GPIO_ACTIVE_LOW>;
		};
	};

	aliases {
		led0 = &led0;
		sw0 = &key1;
		sw1 = &key2;
		rtc = &rtc;
		watchdog0 = &wdt;
	};
};

&cpu0 {
	clock-frequency = <DT_FREQ_M(240)>;
};

&hxt48 {
	status = "okay";
};

&rcc_clk {
	status = "okay";

	sifli,hdiv = <1>;
	sifli,pdiv1 = <1>;
	sifli,pdiv2 = <6>;
	sifli,sys-clk-src = "dll1";

	dll1 {
		status = "okay";
		clock-frequency = <DT_FREQ_M(240)>;
	};
};

&rcc_rst {
	status = "okay";
};

&gpioa_00_31 {
	status = "okay";
};

&gpioa_32_44 {
	status = "okay";
};

&dmac {
	status = "okay";
};

&mpi2 {
	compatible = "sifli,sf32lb-mpi-qspi-nor";
	dmas = <&dmac 0 SF32LB52X_DMA_REQ_MPI2 SF32LB_DMA_PL_MEDIUM>;
	sifli,psclr = <0>;
	sifli,lines = <4>;
	status = "okay";

	py25q128ha: flash@0 {
		compatible = "puya,py25q128ha", "jedec,qspi-nor";
		reg = <0x0>;
		size = <DT_SIZE_M(128)>;
		quad-enable-requirements = "S2B1v1";

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			ptable: partition@0 {
				label = "ptable";
				reg = <0x0 DT_SIZE_K(64)>;
			};

			code: partition@10000 {
				label = "code";
				reg = <0x10000 DT_SIZE_K(16320)>;
			};
		};
	};
};

&pinctrl {
	status = "okay";
};

&usart1 {
	status = "okay";
	current-speed = <1000000>;
	pinctrl-0 = <&usart1_default>;
	pinctrl-names = "default";
};

&wdt {
	status = "okay";
};

&rtc {
	status = "okay";
};

&i2c1 {
	status = "okay";
	pinctrl-0 = <&i2c1_default>;
	pinctrl-names = "default";
	clock-frequency = <I2C_BITRATE_FAST>;
};

&crc {
	status = "okay";
};

temp_sensor: &tsen {
	status = "okay";
};

&trng {
	status = "okay";
};

&mailbox {
	status = "okay";
};

&spi1 {
	status = "okay";
	pinctrl-0 = <&spi1_default>;
	pinctrl-names = "default";
};
