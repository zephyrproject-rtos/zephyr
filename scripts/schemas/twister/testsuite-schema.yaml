$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://zephyrproject.org/schemas/twister/testsuite-schema"
title: "Zephyr Test Suite Schema"
description: "Schema to validate a YAML file describing a Zephyr test suite"
type: "object"
properties:
  common:
    $ref: "#/$defs/scenario-schema"
  sample:
    type: "object"
    required: ["name"]
    properties:
      name:
        type: "string"
      description:
        type: "string"
  tests:
    type: "object"
    additionalProperties:
      $ref: "#/$defs/scenario-schema"
$defs:
  scenario-schema:
    type: "object"
    properties:
      arch_exclude:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      arch_allow:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      vendor_exclude:
        type: "array"
        items:
          type: "string"
      vendor_allow:
        type: "array"
        items:
          type: "string"
      testcases:
        type: "array"
        items:
          type: "string"
      build_only:
        type: "boolean"
      build_on_all:
        type: "boolean"
      depends_on:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      extra_args:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      extra_configs:
        type: "array"
        items:
          type: "string"
      extra_conf_files:
        type: "array"
        items:
          type: "string"
      extra_overlay_confs:
        type: "array"
        items:
          type: "string"
      extra_dtc_overlay_files:
        type: "array"
        items:
          type: "string"
      extra_sections:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      expect_reboot:
        type: "boolean"
      required_snippets:
        type: "array"
        items:
          type: "string"
      filter:
        type: "string"
      levels:
        type: "array"
        items:
          type: "string"
          enum:
            [
              "smoke",
              "unit",
              "integration",
              "acceptance",
              "system",
              "regression",
            ]
      integration_platforms:
        type: "array"
        items:
          type: "string"
      integration_toolchains:
        type: "array"
        items:
          type: "string"
      ignore_faults:
        type: "boolean"
      ignore_qemu_crash:
        type: "boolean"
      harness:
        type: "string"
      harness_config:
        type: "object"
        properties:
          power_measurements:
            type: "object"
          shell_commands_file:
            type: "string"
          shell_commands:
            type: "array"
            items:
              type: "object"
              required: ["command"]
              properties:
                command:
                  type: "string"
                expected:
                  type: "string"
          display_capture_config:
            type: "string"
          type:
            type: "string"
          fixture:
            type: "string"
          ordered:
            type: "boolean"
          pytest_root:
            type: "array"
            items:
              type: "string"
          pytest_args:
            type: "array"
            items:
              type: "string"
          pytest_dut_scope:
            type: "string"
            enum: ["function", "class", "module", "package", "session"]
          ctest_args:
            type: "array"
            items:
              type: "string"
          regex:
            type: "array"
            items:
              type: "string"
          robot_testsuite:
            oneOf:
              - type: "string"
              - type: "array"
                items:
                  type: "string"
          robot_option:
            oneOf:
              - type: "string"
              - type: "array"
                items:
                  type: "string"
          record:
            type: "object"
            required: ["regex"]
            properties:
              regex:
                type: "array"
                items:
                  type: "string"
              merge:
                type: "boolean"
              as_json:
                type: "array"
                items:
                  type: "string"
          bsim_exe_name:
            type: "string"
          ztest_suite_repeat:
            type: "integer"
          ztest_test_repeat:
            type: "integer"
          ztest_test_shuffle:
            type: "boolean"
      min_ram:
        type: "integer"
      min_flash:
        type: "integer"
      modules:
        type: "array"
        items:
          type: "string"
      platform_exclude:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      platform_allow:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      platform_type:
        type: "array"
        items:
          type: "string"
          enum: ["mcu", "qemu", "sim", "unit", "native"]
      platform_key:
        type: "array"
        items:
          type: "string"
      simulation_exclude:
        type: "array"
        items:
          type: "string"
          enum:
            - "qemu"
            - "simics"
            - "xt-sim"
            - "renode"
            - "nsim"
            - "mdb-nsim"
            - "tsim"
            - "armfvp"
            - "native"
            - "custom"
      tags:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      timeout:
        type: "integer"
      toolchain_exclude:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      toolchain_allow:
        oneOf:
          - type: "string"
          - type: "array"
            items:
              type: "string"
      type:
        type: "string"
        enum: ["unit"]
      skip:
        type: "boolean"
      slow:
        type: "boolean"
      sysbuild:
        type: "boolean"
