# Copyright (c) 2020 Tobias Svehagen
# Copyright (c) 2023 Meta
# Copyright (c) 2026 Antmicro
#
# SPDX-License-Identifier: Apache-2.0

menuconfig ZVFS
	bool "Zephyr virtual filesystem (ZVFS) support [EXPERIMENTAL]"
	select EXPERIMENTAL
	help
	  ZVFS is a central, Zephyr-native library that provides a common interoperable API for all
	  types of file descriptors such as those from the non-virtual FS, sockets, eventfds, FILE *'s
	  and more. It is designed to be used by all Zephyr subsystems that need to work with files.

if ZVFS

config ZVFS_FDTABLE
	bool "ZVFS file descriptor table"
	default y
	help
	  This file provides generic file descriptor table implementation, suitable
	  for any I/O object implementing POSIX I/O semantics (i.e. read/write +
	  aux operations).

if ZVFS_FDTABLE

config ZVFS_DEFAULT_FILE_VMETHODS
	bool "ZVFS default virtual methods for files"
	help
	  Provide typical file operations, which can be referenced in a struct fd_op_vtable
	  and subsequently called by ZVFS functions.

config ZVFS_STDIO_CONSOLE
	bool "read() and write() to/from stdio use console subsystem"
	default y
	depends on CONSOLE_SUBSYS && UART_CONSOLE
	depends on !(CONSOLE_GETCHAR || CONSOLE_GETLINE)
	imply UART_INTERRUPT_DRIVEN
	help
	  Enable to use UART console whenever read() or write() is called
	  on stdin, stdout or stderr.

if ZVFS_STDIO_CONSOLE

config ZVFS_STDIN_BUFSIZE
	int "Buffer size for stdin" if UART_INTERRUPT_DRIVEN
	default 16 if UART_INTERRUPT_DRIVEN
	default 0
	help
	  Size of internal buffer for read()-ing, fread()-ing etc. from stdin.
	  Setting both this and ZVFS_STDOUT_BUFSIZE to 0 will replace
	  interrupt-driven operation with busy-polling and stop poll(), select()
	  and others from working with stdio.

config ZVFS_STDOUT_BUFSIZE
	int "Buffer size for stdout" if UART_INTERRUPT_DRIVEN
	default 16 if UART_INTERRUPT_DRIVEN
	default 0
	help
	  Size of internal buffer for write()-ing, fwrite()-ing etc. to stdout.
	  Setting both this and ZVFS_STDIN_BUFSIZE to 0 will replace
	  interrupt-driven operation with busy-polling and stop poll(), select()
	  and others from working with stdio.

endif # ZVFS_STDIO_CONSOLE

endif

config ZVFS_EVENTFD
	bool "ZVFS event file descriptor support"
	imply ZVFS_POLL
	select ZVFS_FDTABLE
	help
	  Enable support for ZVFS event file descriptors. An eventfd can
	  be used as an event wait/notify mechanism together with POSIX calls
	  like read, write and poll.

if ZVFS_EVENTFD

config ZVFS_EVENTFD_MAX
	int "Maximum number of ZVFS eventfd's"
	default 8 if WIFI_NM_WPA_SUPPLICANT
	default 1
	range 1 4096
	help
	  The maximum number of supported event file descriptors.

config ZVFS_OPEN_ADD_SIZE_EVENTFD
	int "Amount of file descriptors used by ZVFS eventfd"
	default ZVFS_EVENTFD_MAX

endif # ZVFS_EVENTFD

config ZVFS_POLL
	bool "ZVFS poll"
	select POLL
	select ZVFS_FDTABLE
	help
	  Enable support for zvfs_poll().

if ZVFS_POLL

config ZVFS_POLL_MAX
	int "Max number of supported zvfs_poll() entries"
	default NET_SOCKETS_POLL_MAX if NET_SOCKETS_POLL_MAX > 0
	default 8 if NRF70_ENABLE_DUAL_VIF
	default 6 if WIFI_NM_WPA_SUPPLICANT
	default 4 if SHELL_BACKEND_TELNET
	default 3
	help
	  Maximum number of entries supported for poll() call.

config ZVFS_SELECT
	bool "ZVFS select"
	help
	  Enable support for zvfs_select().

endif # ZVFS_POLL

endif # ZVFS
