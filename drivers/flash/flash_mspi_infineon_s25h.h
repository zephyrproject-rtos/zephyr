/*
 * Copyright (c) 2025 Siemens Mobility GmbH
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#ifndef ZEPHYR_DRIVERS_FLASH_MSPI_INFINEON_S25H_
#define ZEPHYR_DRIVERS_FLASH_MSPI_INFINEON_S25H_

#include "zephyr/kernel.h"
#include "zephyr/sys/util_macro.h"

/* defaults */
#define INF_MSPI_S25H_DEFAULT_MSPI_TIMEOUT 100

/* opcodes 1-1-1 mode */
#define INF_MSPI_S25H_OPCODE_WRITE_ENABLE  0x06
#define INF_MSPI_S25H_OPCODE_WRITE_DISABLE 0x04

#define INF_MSPI_S25H_OPCODE_READ_ANY_REGISTER  0x65
#define INF_MSPI_S25H_OPCODE_WRITE_ANY_REGISTER 0x71

#define INF_MSPI_S25H_OPCODE_ERASE_256K  0xD8
#define INF_MSPI_S25H_OPCODE_READ_FLASH  0x03
#define INF_MSPI_S25H_OPCODE_WRITE_FLASH 0x02

#define INF_MSPI_S25H_OPCODE_RESET_ENABLE 0x66
#define INF_MSPI_S25H_OPCODE_RESET        0x99

#define INF_MSPI_S25H_OPCODE_READ_JEDEC_ID 0x9F

/* opcodes 4-4-4 mode */
#define INF_MSPI_S25H_OPCODE_READ_FLASH_QUAD    0xEB
#define INF_MSPI_S25H_OPCODE_READ_JEDEC_ID_QUAD 0xAF

/* RX delay */
/* 2 cycles for the mode bit to be ignored in Quad SPI mode; 8 from the default configuration */
#define INF_MSPI_S25H_DELAY_READ_QUADSPI (2 + 8)

/* addresses */
#define INF_MSPI_S25H_ADDRESS_VOLATILE_STATUS_1 0x00800000
#define INF_MSPI_S25H_ADDRESS_VOLATILE_STATUS_2 0x00800001

#define INF_MSPI_S25H_ADDRESS_VOLATILE_CFG_1 0x00800002
#define INF_MSPI_S25H_ADDRESS_VOLATILE_CFG_2 0x00800003
#define INF_MSPI_S25H_ADDRESS_VOLATILE_CFG_3 0x00800004
#define INF_MSPI_S25H_ADDRESS_VOLATILE_CFG_4 0x00800005

#define INF_MSPI_S25H_ADDRESS_NON_VOLATILE_STATUS_1 0x0

#define INF_MSPI_S25H_ADDRESS_NON_VOLATILE_CFG_1 0x2
#define INF_MSPI_S25H_ADDRESS_NON_VOLATILE_CFG_2 0x3
#define INF_MSPI_S25H_ADDRESS_NON_VOLATILE_CFG_3 0x4
#define INF_MSPI_S25H_ADDRESS_NON_VOLATILE_CFG_4 0x5

/* device specific data */
#define INF_MSPI_S25H_MANUFACTURER_ID 0x34
#define INF_MSPI_S25H_DEVICE_ID       0x2A1A

#define INF_MSPI_S25H_ERASE_SECTOR_SIZE 262144
#define INF_MSPI_S25H_WRITE_BLOCK_SIZE  256

/* default data */
#define INF_MSPI_S25H_DEFAULT_XFER_DATA                                                            \
	.async = false, .cmd_length = 1, .hold_ce = false, .priority = 0, .tx_dummy = 0,           \
	.xfer_mode = MSPI_PIO

#define INF_MSPI_S25H_DEFAULT_XFER_DATA_SINGLE_CMD                                                 \
	INF_MSPI_S25H_DEFAULT_XFER_DATA, .rx_dummy = 0, .addr_length = 0, .num_packet = 1

#define INF_MSPI_S25H_TIMEOUT_IDLE_RETRY_INTERVAL_MS 10
#define INF_MSPI_S25H_TIMEOUT_IDLE_RETRY_INTERVAL                                                  \
	K_MSEC(INF_MSPI_S25H_TIMEOUT_IDLE_RETRY_INTERVAL_MS)
#define INF_MSPI_S25H_TIMEOUT_IDLE_ERASE_SECTOR_MS 1000
#define INF_MSPI_S25H_TIMEOUT_IDLE_WRITE_BLOCK_MS  1000
#define INF_MSPI_S25H_TIMEOUT_IDLE_STARTUP         100

/* register bits */
#define INF_MSPI_S25H_STATUS_1_RDYBSY_BIT   BIT(0)
#define INF_MSPI_S25H_STATUS_1_WRPGEN_BIT   BIT(1)
#define INF_MSPI_S25H_STATUS_1_LBPROT_SHIFT 2
#define INF_MSPI_S25H_STATUS_1_LBPROT_MASK  BIT_MASK(3)
#define INF_MSPI_S25H_STATUS_1_ERSERR_BIT   BIT(5)
#define INF_MSPI_S25H_STATUS_1_PRGERR_BIT   BIT(6)
#define INF_MSPI_S25H_STATUS_1_STCFWR_BIT   BIT(7)

#define INF_MSPI_S25H_STATUS_2_PROGMS_BIT BIT(0)
#define INF_MSPI_S25H_STATUS_2_ERASES_BIT BIT(1)
#define INF_MSPI_S25H_STATUS_2_SESTAT_BIT BIT(2)
#define INF_MSPI_S25H_STATUS_2_DICRCA_BIT BIT(3)
#define INF_MSPI_S25H_STATUS_2_DICRCS_BIT BIT(4)

#define INF_MSPI_S25H_CFG_1_TLPROT_BIT BIT(0)
#define INF_MSPI_S25H_CFG_1_QUADIT_BIT BIT(1)
#define INF_MSPI_S25H_CFG_1_TB4KBS_BIT BIT(2)
#define INF_MSPI_S25H_CFG_1_PLPROT_BIT BIT(4)
#define INF_MSPI_S25H_CFG_1_TBPROT_BIT BIT(5)
#define INF_MSPI_S25H_CFG_1_SP4KBS_BIT BIT(6)

#define INF_MSPI_S25H_CFG_2_MEMLAT_SHIFT 0
#define INF_MSPI_S25H_CFG_2_MEMLAT_MASK  BIT_MASK(4)
#define INF_MSPI_S25H_CFG_2_DQ3RST_BIT   BIT(5)
#define INF_MSPI_S25H_CFG_2_QPI_IT_BIT   BIT(6)
#define INF_MSPI_S25H_CFG_2_ADRBYT_BIT   BIT(7)

#define INF_MSPI_S25H_CFG_3_LSFRST_BIT   BIT(0)
#define INF_MSPI_S25H_CFG_3_CLSRSM_BIT   BIT(2)
#define INF_MSPI_S25H_CFG_3_UNHYSA_BIT   BIT(3)
#define INF_MSPI_S25H_CFG_3_PGMBUF_BIT   BIT(4)
#define INF_MSPI_S25H_CFG_3_BLKCHK_BIT   BIT(5)
#define INF_MSPI_S25H_CFG_3_VRGLAT_SHIFT 6
#define INF_MSPI_S25H_CFG_3_VRGLAT_MASK  BIT_MASK(2)

#define INF_MSPI_S25H_CFG_4_RBSTWL_SHIFT 0
#define INF_MSPI_S25H_CFG_4_RBSTWL_MASK  BIT_MASK(2)
#define INF_MSPI_S25H_CFG_4_DPDPOR_BIT   BIT(2)
#define INF_MSPI_S25H_CFG_4_ECC12S_BIT   BIT(3)
#define INF_MSPI_S25H_CFG_4_RBSTWP_BIT   BIT(4)
#define INF_MSPI_S25H_CFG_4_IOIMPD_SHIFT 5
#define INF_MSPI_S25H_CFG_4_IOIMPD_MASK  BIT_MASK(3)

#endif /* ZEPHYR_DRIVERS_FLASH_MSPI_INFINEON_S25H_ */
