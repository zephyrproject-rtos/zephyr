/*
 * Copyright (c) 2020 Cobham Gaisler AB
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/*
 * This file is based on:
 *   qemu-system-riscv32 -machine virt,dumpdtb=virt.dtb -smp 8 -m 256
 *   dtc virt.dtb > virt.dtsi
 */

/dts-v1/;

/ {
	#address-cells = <0x01>;
	#size-cells = <0x01>;
	compatible = "riscv-virtio";
	model = "riscv-virtio,qemu";

	flash@20000000 {
		bank-width = <0x04>;
		reg = <0x20000000 0x2000000 0x22000000 0x2000000>;
		compatible = "cfi-flash";
	};

	uart0: uart@10000000 {
		interrupts = <0x0a 1>;
		interrupt-parent = <&aplic>;
		clock-frequency = <0x384000>;
		reg = <0x10000000 0x100>;
		compatible = "ns16550";
		reg-shift = <0>;
	};

	cpus {
		#address-cells = <0x01>;
		#size-cells = <0x00>;

		cpu@0 {
			device_type = "cpu";
			reg = <0x00>;
			status = "okay";
			compatible = "qemu,riscv-virt", "riscv";

			aplic0: interrupt-controller {
				compatible = "riscv,cpu-intc";
				#interrupt-cells = <0x01>;
				interrupt-controller;	
			};
		};

		cpu@1 {
			device_type = "cpu";
			reg = <0x01>;
			status = "okay";
			compatible = "qemu,riscv-virt", "riscv";

			aplic1: interrupt-controller {
				compatible = "riscv,cpu-intc";
				#interrupt-cells = <0x01>;
				interrupt-controller;
			};
		};

		cpu@2 {
			device_type = "cpu";
			reg = <0x02>;
			status = "okay";
			compatible = "qemu,riscv-virt", "riscv";

			aplic2: interrupt-controller {
				compatible = "riscv,cpu-intc";
				#interrupt-cells = <0x01>;
				interrupt-controller;		
			};
		};

		cpu@3 {
			device_type = "cpu";
			reg = <0x03>;
			status = "okay";
			compatible = "qemu,riscv-virt", "riscv";

			aplic3: interrupt-controller {
				compatible = "riscv,cpu-intc";
				#interrupt-cells = <0x01>;
				interrupt-controller;
            };
		};

		cpu@4 {
			device_type = "cpu";
			reg = <0x04>;
			status = "okay";
			compatible = "qemu,riscv-virt", "riscv";

            aplic4: interrupt-controller {
                compatible = "riscv,cpu-intc";
				#interrupt-cells = <0x01>;
				interrupt-controller;
            };
		};

		cpu@5 {
			device_type = "cpu";
			reg = <0x05>;
			status = "okay";
			compatible = "qemu,riscv-virt", "riscv";

            aplic5: interrupt-controller {
                compatible = "riscv,cpu-intc";
                #interrupt-cells = <0x01>;
                interrupt-controller;
            };
		};

		cpu@6 {
			device_type = "cpu";
			reg = <0x06>;
			status = "okay";
			compatible = "qemu,riscv-virt", "riscv";

            aplic6: interrupt-controller {
                compatible = "riscv,cpu-intc";
				#interrupt-cells = <0x01>;
				interrupt-controller;
            };
		};

		cpu@7 {
			device_type = "cpu";
			reg = <0x07>;
			status = "okay";
			compatible = "qemu,riscv-virt", "riscv";

            aplic7: interrupt-controller {
                compatible = "riscv,cpu-intc";
				#interrupt-cells = <0x01>;
				interrupt-controller;
            };
		};
	};

	ram0: memory@80000000 {
		device_type = "memory";
		reg = <0x80000000 0x10000000>;
	};

	soc {
		#address-cells = <0x01>;
		#size-cells = <0x01>;
		compatible = "simple-bus";
		ranges;

        aplic: interrupt-controller@c000000 {
            phandle = <0x11>;
			riscv,num-sources = <0x60>;
	        reg = <0xc000000 0x8000>;
			interrupts-extended = <&aplic0 0x0b
                            &aplic1 0x0b
                            &aplic2 0x0b
                            &aplic3 0x0b
                            &aplic4 0x0b
                            &aplic5 0x0b
                            &aplic6 0x0b
                            &aplic7 0x0b>;
            interrupt-controller;
            compatible = "riscv,aplic";
            #address-cells = <0x00>;
            #interrupt-cells = <0x02>;			
            status = "okay";
        };
	
		clint: clint@2000000 {
			compatible = "sifive,clint0";
			reg = <0x2000000 0x10000>;
			interrupts-extended = <&aplic0 0x03 &aplic0 0x07
                            &aplic1 0x03 &aplic1 0x07
                            &aplic2 0x03 &aplic2 0x07
                            &aplic3 0x03 &aplic3 0x07
							&aplic4 0x03 &aplic4 0x07
                            &aplic5 0x03 &aplic5 0x07
                            &aplic6 0x03 &aplic6 0x07
                            &aplic7 0x03 &aplic7 0x07>;
		};

		mtimer: timer@200bff8 {
			compatible = "riscv,machine-timer";
			interrupts-extended = <&aplic0 7
                            &aplic1 7
                            &aplic2 7
                            &aplic3 7
                            &aplic4 7
                            &aplic5 7
                            &aplic6 7
							&aplic7 7>;
			reg = <0x200bff8 0x8 0x2004000 0x8>;
			reg-names = "mtime", "mtimecmp";
		};
	};
};
