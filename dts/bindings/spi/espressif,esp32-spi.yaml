description: |
  ESP32 SPI controller

  Hardware chip select is directly handled via pinctrl. The reg property of
  a child SPI device node corresponds to the hardware CS pin number configured
  in pinctrl. ESP32 supports CS0-CS2, while ESP32-S2/S3/C2/C3/C6/H2 support
  CS0-CS5.

  Alternatively, GPIO-based chip selects can be used via the cs-gpios property.
  When cs-gpios is defined, the hardware CS lines are disabled and the driver
  uses GPIO pins for chip select control. In this case, the reg property of
  child nodes corresponds to the index in the cs-gpios array.

  Example with hardware CS (directly via pinctrl):

    &spi2 {
        pinctrl-0 = <&spim2_default>;  /* Must include CS signal */
        pinctrl-names = "default";

        device@0 {
            reg = <0>;  /* Uses hardware CS0 */
        };
    };

  Example with GPIO CS:

    &spi2 {
        pinctrl-0 = <&spim2_default>;  /* CS signal optional */
        pinctrl-names = "default";
        cs-gpios = <&gpio0 5 GPIO_ACTIVE_LOW>,
                   <&gpio0 6 GPIO_ACTIVE_LOW>;

        device@0 {
            reg = <0>;  /* Uses first GPIO (gpio0 pin 5) */
        };
        device@1 {
            reg = <1>;  /* Uses second GPIO (gpio0 pin 6) */
        };
    };

compatible: "espressif,esp32-spi"

include: [spi-controller.yaml, pinctrl-device.yaml]

properties:
  reg:
    required: true

  pinctrl-0:
    required: true

  pinctrl-names:
    required: true

  half-duplex:
    type: boolean
    description: |
      Enable half-duplex communication mode.

      Transmit data before receiving it, instead of simultaneously

  dummy-comp:
    type: boolean
    description: Enable dummy SPI compensation cycles

  sio:
    type: boolean
    description: |
      Enable 3-wire mode

      Use MOSI for both sending and receiving data

  dma-enabled:
    type: boolean
    description: Enable SPI DMA support

  dma-clk:
    type: int
    description: DMA clock source

  dma-host:
    type: int
    description: DMA Host - 0 -> SPI2, 1 -> SPI3

  clk-as-cs:
    type: boolean
    description: |
      Support to toggle the CS while the clock toggles

      Output clock on CS line if CS is active

  positive-cs:
    type: boolean
    description: Make CS positive during a transaction instead of negative

  use-iomux:
    type: boolean
    description: |
      Some pins are allowed to bypass the GPIO Matrix and use the IO_MUX
      routing mechanism instead, this avoids extra routing latency and makes
      possible the use of operating frequencies higher than 20 MHz.

      Refer to SoC's Technical Reference Manual to check which pins are
      allowed to use this routing path.

  cs-setup-time:
    type: int
    description: |
      Chip select setup time setting, see TRF for SOC for details of
      timing applied.

  cs-hold-time:
    type: int
    description: |
      Chip select hold time setting, see TRF for SOC for details of
      timing applied.

  line-idle-low:
    type: boolean
    description: |
      Default MISO and MOSI pins GPIO level when idle. Defaults to high by default.
