# Copyright (c) 2018, Endre Karlson
# Copyright (c) 2018, Song Qiang <songqiang1304521@gmail.com>
# Copyright (c) 2025 STMicroelectronics
# SPDX-License-Identifier: Apache-2.0

description: STM32 ADC

compatible: "st,stm32-adc"

include: [adc-controller.yaml, pinctrl-device.yaml]

properties:
  reg:
    required: true

  clocks:
    required: true

  clock-names:
    required: true
    enum:
      - "adcx"
      - "adc_ker"
      - "adc_pre"
    description: |
      Expected names are the following:
      - "adcx" for the enabling the register clock (mandatory)
      - "adc_ker" for configuring the kernel clock (if applicable)
      - "adc_pre" for configuring the prescaler (if applicable)
      Kernel clock and prescaler may be shared between several ADC instances.
      In that case, the same kernel clock/prescaler Device Tree configuration
      must be used on all instances that share the kernel clock/prescaler
      to avoid conflicts.

  interrupts:
    required: true

  "#io-channel-cells":
    const: 1

  st,adc-clock-source:
    type: string
    required: true
    enum:
      - "SYNC"
      - "ASYNC"
    description: |
      Type of ADC clock source :
      - "SYNC": derived from the bus clock.
      - "ASYNC" : independent and asynchronous with the bus clock
      One of the two values may not apply to some series. Refer to the RefMan.
      If an asynchronous clock is selected, a kernel clock in the "clocks" property
      has to be defined explicitly.

  st,adc-prescaler:
    type: int
    required: true
    enum:
      - 1 # not divided
      - 2
      - 4
      - 6
      - 8
      - 10
      - 12
      - 16
      - 32
      - 64
      - 128
      - 256
    description: |
      Clock prescaler at the input of the ADC:
      Apply to synchronous or asynchronous clock depending on the STM32
      st,adc-clock-source.
      Some of the values may not apply to some series, and may depend on the
      selected clock source. Refer to the RefMan.
      On STM32F3x, this configures only the synchronous prescaler
      (use the "clocks" property to set asynchronous prescaler).

  vref-mv:
    type: int
    default: 3300
    description: Indicates the reference voltage of the ADC in mV (on the target board).

  resolutions:
    type: array
    required: true
    description: |
      List of the resolutions supported by the ADC instance. They should be
      values created with STM32_ADC_RES macro or similar. Their order is not
      important. For example for STM32F4:
        <STM32_ADC_RES(12, 0x00) STM32_ADC_RES(10, 0x01)
         STM32_ADC_RES(8, 0x02)  STM32_ADC_RES(6, 0x03)>
      The two parameters are the resolution (for example 10 bits) and the
      corresponding register value (0x01 for a 10-bit resolution).
      By design, these macros also contains all register information (address,
      field offset and field mask) necessary to properly set the resolution.

  sampling-times:
    type: array
    required: true
    description: |
      List all the sampling times supported by the ADC instance.
      Rounded up if needed. Order is important: their index matches their binary
      value in the register.

  num-sampling-time-common-channels:
    type: int
    description: |
      Number of sampling time common channels for this ADC instance, if any.

  st,adc-sequencer:
    type: string
    required: true
    enum:
      - "fixed"
      - "programmable"
    description: |
      Type of ADC sequencer:
      - "fixed": Channels of a sequence are sampled from lowest to highest.
      - "programmable": Channels of a sequence can be sampled in any order.

  st,adc-oversampler:
    type: string
    required: true
    enum:
      - "none"
      - "minimal"
      - "extended"
    description: |
      Type of ADC oversampler:
      - "none": No oversampler
      - "minimal": Oversampler with 8 possible oversampling values (2, 4, 8, ..., 256)
      - "extended": Oversampler with 1024 possible oversampling values (1..1024)

  st,adc-internal-regulator:
    type: string
    required: true
    enum:
      - "none"
      - "startup-sw-delay"
      - "startup-hw-status"
    description: |
      Presence and type of ADC internal regulator if any.
      - "none": No internal regulator.
      - "startup-sw-delay": Internal regulator is present and its startup time is checked with a
        software delay.
      - "startup-hw-status": Internal regulator is present and its startup time is checked with a
        status flag in a register.

  st,adc-has-deep-powerdown:
    type: boolean
    description: |
      If present, it indicates that the ADC instance has a deep power down feature.

  st,adc-has-channel-preselection:
    type: boolean
    description: |
      If present, it indicates that the ADC instance has a channel preselection register.

  st,adc-has-differential-support:
    type: boolean
    description: |
      If present, it indicates that the ADC instance supports differential channel inputs.

io-channel-cells:
  - input
