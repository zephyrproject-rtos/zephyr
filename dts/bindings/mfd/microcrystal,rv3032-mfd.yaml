# Copyright (c) 2025 Baylibre SAS
#
# SPDX-License-Identifier: Apache-2.0
#

description: |
  Microcrystal rv-3032-c7 I2C MFD

  The following example displays the node layout
  with every possible partial driver included.

  rv3032: rv3032c7@51 {
    compatible = "microcrystal,rv3032-mfd";
    reg = <0x51>;
    int-gpios = <&porta 11 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
    evi-gpios = <&porta 10 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
    backup-switch-mode = "disabled";
    always-on;
    status = "okay";

    rtc0: rv3032_rtc {
      compatible = "microcrystal,rv3032";
      status = "okay";
    };

    counter0: rv3032_counter {
      compatible = "microcrystal,rv3032-counter";
      status = "okay";
    };

    temp0: rv3032_temp {
      compatible = "microcrystal,rv3032-temp";
      low-temp = <40>;
      high-temp = <105>;
      status = "okay";
    };
  };

compatible: "microcrystal,rv3032-mfd"

include:
  - name: i2c-device.yaml

properties:
  int-gpios:
    type: phandle-array
    description: |
      GPIO connected to the RV3028 INT interrupt output. This signal is open-drain, active low.

  evi-gpios:
    type: phandle-array
    description: |
      GPIO connected to the RV3028 EVI event/interrupt input. This signal is open-drain, active low.

  always-on:
    type: boolean
    description: |
      AON stand for - Always On. This is not part of rv-3032-c7 chip functionality but
      real use case where main power is kept always on and advanced backup-switch is not
      used as expected.
        - true  : Driver act like power was not interrupted on next device init
        - false : Every boot and execution of driver init function is like fresh boot.
                  alarms are cleaned and device is clean.

  backup-switch-mode:
    type: string
    required: true
    enum:
      - disabled
      - direct
      - level
    description: |
      Automatic backup switchover function selection:
        - disabled: The switchover function is disabled - only one power supply available (VDD)
        - direct: Direct Switching Mode (DSM): when VDD < VBACKUP, switchover occurs from VDD to
          VBACKUP without requiring VDD to drop below VTH:LSM (2.0 V)
        - level: Level Switching Mode (LSM): when VDD < VTH:LSM (2.0 V) AND VBACKUP > VTH:LSM,
          switchover occurs from VDD to VBACKUP
